
<html>
<head>
  <title>A Leaflet map!</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
  <script src="https://nlmaps.nl/dist/nlmaps.iife.js"></script>

{% load static %}
<link rel="stylesheet" type="text/css" href="{% static "/base/css/base.css" %}" type="text/css"/>
<style>
    #map{ height: 100% }
</style>

</head>
<body>

  <div id="nlmaps-holder"></div>

<script>
    function GetData(map, layers) {
      // Load map data for the current map bounds
      bounds = map.getBounds()
      console.log('Bounds now:', bounds.toBBoxString())

      var parameters = {
          bbox: map.getBounds().toBBoxString()
      };
      fullUrl = 'geodata/objects/89' +L.Util.getParamString(parameters)
      console.log('aap',fullUrl)


      var request = new XMLHttpRequest();
      request.open('GET',fullUrl, true);
      request.onload = function(){
          if (request.status >= 200 && request.status < 400){
              // success
              var data = JSON.parse(request.responseText);
              console.log('Received OK!')
              //  Work with JSON data here
              layers['fields'].clearLayers()
              layers['fields'].addData(data);      
              console.log(data.properties.name)  
          } else {
              // made connection, got error
              console.log(request.responseText)
          }
      };
      request.onerror = function () {
          console.log('Error receiving data')
      };
      request.send();
    }


    var nlMapsHolder = document.getElementById('nlmaps-holder');
    nlMapsHolder.style.height = '100%'; // Change to required height
    
    var opts = {
        style: 'grijs',
        target: 'nlmaps-holder',
        center: {
            longitude: 6.585402,
            latitude: 52.386392
        },
        overlay: 'false',
        marker: false,
        zoom: 8,
        search: true
    };
    var map = nlmaps.createMap(opts);

    layers = {'fields':L.geoJSON().addTo(map),
              'locs':L.geoJSON().addTo(map),
              'putten':L.geoJSON().addTo(map)
              }

    map.on("moveend", function () {
      GetData( map, layers )
    });

    console.log(map)
    GetData(map,layers)

</script>


</body>
</html>



<!--   <div id="map"></div>

  <script>

  // initialize the map
  var map = L.map('map').setView([42.35, -71.08], 13);

  // load a tile layer
  L.tileLayer('http://tiles.mapc.org/basemap/{z}/{x}/{y}.png',
    {
      attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
      maxZoom: 17,
      minZoom: 9
    }).addTo(map);

  </script>
 -->